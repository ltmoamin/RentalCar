<div class="notification-wrapper">
    <button class="bell-btn" (click)="toggleDropdown($event)" [class.active]="showDropdown">
        <i class="fas fa-bell"></i>
        <span class="badge" *ngIf="unreadCount > 0">{{ unreadCount > 9 ? '9+' : unreadCount }}</span>
    </button>

    <div class="dropdown-menu" *ngIf="showDropdown" (click)="$event.stopPropagation()">
        <div class="dropdown-header">
            <h3>Notifications</h3>
            <button class="mark-all" (click)="markAllAsRead($event)" *ngIf="unreadCount > 0">Mark all as read</button>
        </div>

        <div class="notification-list" *ngIf="!loading; else loadingTpl">
            <div class="notification-item" *ngFor="let n of groupedNotifications" [class.unread]="!n.read"
                [routerLink]="n.link || null" (click)="markAsRead($event, n); closeDropdown()">
                <div class="icon-box" [ngClass]="n.type.toLowerCase()">
                    <i [class]="getIconClass(n.type)"></i>
                </div>
                <div class="content">
                    <p class="title">{{ n.title }}</p>
                    <p class="message">{{ n.message }}</p>
                    <span class="time">{{ n.createdAt | date:'shortTime' }}</span>
                </div>
                <div class="unread-dot" *ngIf="!n.read"></div>
            </div>

            <div class="empty-state" *ngIf="groupedNotifications.length === 0">
                <i class="fas fa-bell-slash"></i>
                <p>No notifications yet</p>
            </div>
        </div>

        <ng-template #loadingTpl>
            <div class="loading-state">
                <div class="spinner"></div>
            </div>
        </ng-template>

        <a [routerLink]="viewAllLink" class="view-all" (click)="closeDropdown()">
            View all notifications
        </a>
    </div>
</div>