<div class="my-bookings-page">
    <div class="container">
        <header class="page-header animate-slide-up">
            <div class="title-group">
                <h1>My Reservations</h1>
                <p>Manage and view your upcoming and past car rentals.</p>
            </div>
            <div class="actions">
                <a routerLink="/cars" class="btn btn-primary">
                    <i class="fa-solid fa-plus"></i> New Booking
                </a>
            </div>
        </header>

        <div class="bookings-content" *ngIf="!isLoading">
            <div class="empty-state animate-fade-in" *ngIf="bookings.length === 0">
                <i class="fa-solid fa-calendar-xmark"></i>
                <h2>No Reservations Found</h2>
                <p>You haven't made any bookings yet. Explore our premium fleet and start your journey today!</p>
                <a routerLink="/cars" class="btn btn-outline-primary">Browse Cars</a>
            </div>

            <div class="bookings-grid-container" *ngIf="bookings.length > 0">
                <!-- Upcoming Section -->
                <div class="section-container animate-slide-up" *ngIf="upcomingBookings.length > 0">
                    <h2 class="section-title"><i class="fa-solid fa-clock"></i> Upcoming Rentals</h2>
                    <div class="bookings-grid">
                        <div class="booking-card animate-scale-in"
                            *ngFor="let booking of upcomingBookings; let i = index"
                            [style.animation-delay]="i * 0.1 + 's'">
                            <!-- ... card content same as before ... -->
                            <div class="car-info">
                                <img [src]="booking.carImageUrl | carImage" [alt]="booking.carName">
                                <div class="info-text">
                                    <h3>{{ booking.carName }}</h3>
                                    <span class="booking-id">ID: #BK-{{ booking.id }}</span>
                                </div>
                            </div>

                            <div class="booking-details">
                                <div class="detail-item">
                                    <i class="fa-solid fa-calendar-day"></i>
                                    <div class="text">
                                        <span class="label">Pickup</span>
                                        <span class="value">{{ booking.startDate | date:'mediumDate' }}</span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <i class="fa-solid fa-calendar-check"></i>
                                    <div class="text">
                                        <span class="label">Return</span>
                                        <span class="value">{{ booking.endDate | date:'mediumDate' }}</span>
                                    </div>
                                </div>
                                <div class="detail-item price">
                                    <i class="fa-solid fa-tag"></i>
                                    <div class="text">
                                        <span class="label">Total Paid</span>
                                        <span class="value">\${{ booking.totalPrice }}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="booking-footer">
                                <div class="status-badge" [ngClass]="getStatusClass(booking.status)">
                                    <i class="fa-solid fa-circle"></i>
                                    {{ booking.status }}
                                </div>
                                <div class="footer-actions">
                                    <a *ngIf="booking.status === BookingStatus.PENDING"
                                        [routerLink]="['/checkout', booking.id]" class="btn btn-pay">
                                        <i class="fa-solid fa-credit-card"></i> Pay Now
                                    </a>
                                    <a [routerLink]="['/cars', booking.carId]" class="btn btn-link">
                                        View Car <i class="fa-solid fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Past Section -->
                <div class="section-container animate-slide-up" *ngIf="pastBookings.length > 0"
                    [style.margin-top]="'3rem'">
                    <h2 class="section-title past"><i class="fa-solid fa-clock-rotate-left"></i> Past Rentals</h2>
                    <div class="bookings-grid">
                        <div class="booking-card animate-scale-in past"
                            *ngFor="let booking of pastBookings; let i = index" [style.animation-delay]="i * 0.1 + 's'">
                            <!-- Copy of card structure for past -->
                            <div class="car-info">
                                <img [src]="booking.carImageUrl | carImage" [alt]="booking.carName">
                                <div class="info-text">
                                    <h3>{{ booking.carName }}</h3>
                                    <span class="booking-id">ID: #BK-{{ booking.id }}</span>
                                </div>
                            </div>

                            <div class="booking-details">
                                <div class="detail-item">
                                    <i class="fa-solid fa-calendar-day"></i>
                                    <div class="text">
                                        <span class="label">Pickup</span>
                                        <span class="value">{{ booking.startDate | date:'mediumDate' }}</span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <i class="fa-solid fa-calendar-check"></i>
                                    <div class="text">
                                        <span class="label">Return</span>
                                        <span class="value">{{ booking.endDate | date:'mediumDate' }}</span>
                                    </div>
                                </div>
                                <div class="detail-item price">
                                    <i class="fa-solid fa-tag"></i>
                                    <div class="text">
                                        <span class="label">Amount</span>
                                        <span class="value">\${{ booking.totalPrice }}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="booking-footer">
                                <div class="status-badge" [ngClass]="getStatusClass(booking.status)">
                                    <i class="fa-solid fa-circle"></i>
                                    {{ booking.status }}
                                </div>
                                <div class="footer-actions">
                                    <button *ngIf="booking.status === BookingStatus.COMPLETED && !booking.reviewed"
                                        class="btn btn-review" (click)="openReviewModal(booking)">
                                        <i class="fa-solid fa-star"></i> Rate & Review
                                    </button>
                                    <a [routerLink]="['/cars', booking.carId]" class="btn btn-link">
                                        Rebook <i class="fa-solid fa-rotate-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<app-review-form *ngIf="selectedBookingForReview" [show]="showReviewModal" [bookingId]="selectedBookingForReview.id!"
    [carName]="selectedBookingForReview.carName!" (closed)="showReviewModal = false"
    (submittedReview)="handleReviewSubmitted()">
</app-review-form>

<app-loading-spinner *ngIf="isLoading" message="Fetching your reservations..."></app-loading-spinner>