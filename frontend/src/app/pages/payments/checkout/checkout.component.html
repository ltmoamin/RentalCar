<div class="checkout-container">
    <div class="checkout-card" *ngIf="!loading; else loadingTpl">
        <div class="checkout-header">
            <h2>Secure Checkout</h2>
            <p class="subtitle">Complete your booking for <strong>{{ booking?.carName }}</strong></p>
        </div>

        <div class="checkout-body">
            <div class="order-summary">
                <div class="summary-item">
                    <span>Rental Period</span>
                    <span>{{ booking?.startDate | date:'mediumDate' }} - {{ booking?.endDate | date:'mediumDate'
                        }}</span>
                </div>
                <div class="summary-item total">
                    <span>Total Amount</span>
                    <span class="price">{{ booking?.totalPrice | currency:'USD' }}</span>
                </div>
            </div>

            <form [formGroup]="checkoutForm" (ngSubmit)="pay()" class="payment-form">
                <div class="form-section">
                    <h3>Billing Information</h3>
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" formControlName="name" placeholder="John Doe">
                        <small class="error"
                            *ngIf="checkoutForm.get('name')?.touched && checkoutForm.get('name')?.errors?.['required']">
                            Full name is required
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" formControlName="email" placeholder="john@example.com">
                        <small class="error"
                            *ngIf="checkoutForm.get('email')?.touched && checkoutForm.get('email')?.errors?.['email']">
                            Please enter a valid email
                        </small>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Payment Details</h3>
                    <div class="stripe-element-container" *ngIf="elementsOptions">
                        <div ngxStripeElements [elementsOptions]="elementsOptions" [stripe]="stripeService"
                            (elements)="onElements($event)">
                            <ngx-stripe-payment #paymentElement [options]="paymentElementOptions"
                                (ready)="onReady()"></ngx-stripe-payment>
                        </div>
                    </div>
                </div>

                <button type="submit" [disabled]="paying || checkoutForm.invalid || !stripeReady" class="pay-button">
                    <span *ngIf="!paying">Pay {{ booking?.totalPrice | currency:'USD' }}</span>
                    <span *ngIf="paying" class="loader"></span>
                    <span *ngIf="paying">Processing...</span>
                </button>
            </form>
        </div>

        <div class="checkout-footer">
            <p><i class="fas fa-lock"></i> Secured by Stripe. Your data is encrypted.</p>
        </div>
    </div>

    <ng-template #loadingTpl>
        <div class="loading-state">
            <div class="loader"></div>
            <p>Initializing secure checkout...</p>
        </div>
    </ng-template>
</div>