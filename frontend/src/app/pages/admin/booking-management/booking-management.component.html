<div class="booking-mgmt-page">
    <div class="container-fluid">
        <header class="mgmt-header animate-slide-up">
            <div class="title-group">
                <h1>Booking Management</h1>
                <p>Monitor, approve, and manage all car rental reservations.</p>
            </div>
            <div class="stats-overview" *ngIf="!isLoading">
                <div class="stat-item animate-scale-in stagger-1">
                    <span class="label">Total</span>
                    <span class="value">{{ getStats().total }}</span>
                </div>
                <div class="stat-item pending animate-scale-in stagger-2">
                    <span class="label">Pending</span>
                    <span class="value">{{ getStats().pending }}</span>
                </div>
                <div class="stat-item confirmed animate-scale-in stagger-3">
                    <span class="label">Confirmed</span>
                    <span class="value">{{ getStats().confirmed }}</span>
                </div>
                <div class="stat-item completed animate-scale-in stagger-4">
                    <span class="label">Completed</span>
                    <span class="value">{{ getStats().completed }}</span>
                </div>
            </div>
        </header>

        <section class="filters-section animate-slide-up stagger-2">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="applyFilters()"
                    placeholder="Search by user, car, or ID...">
            </div>
            <div class="filter-group">
                <select [(ngModel)]="statusFilter" (ngModelChange)="applyFilters()" class="status-select">
                    <option value="">All Statuses</option>
                    <option [value]="BookingStatus.PENDING">Pending</option>
                    <option [value]="BookingStatus.CONFIRMED">Confirmed</option>
                    <option [value]="BookingStatus.COMPLETED">Completed</option>
                    <option [value]="BookingStatus.CANCELLED">Cancelled</option>
                    <option [value]="BookingStatus.REJECTED">Rejected</option>
                </select>

                <select [(ngModel)]="carFilter" (ngModelChange)="applyFilters()" class="car-select">
                    <option value="">All Cars</option>
                    <option *ngFor="let car of cars" [value]="car.id">
                        {{ car.brand }} {{ car.model }}
                    </option>
                </select>

                <div class="date-filter">
                    <input type="date" [(ngModel)]="dateFilter" (ngModelChange)="applyFilters()" class="date-input">
                </div>
            </div>
        </section>

        <div class="bookings-table-container animate-fade-in stagger-3" *ngIf="!isLoading">
            <table class="premium-table">
                <thead>
                    <tr>
                        <th>Booking ID</th>
                        <th>User</th>
                        <th>Car</th>
                        <th>Period</th>
                        <th>Total Price</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let booking of filteredBookings">
                        <td><span class="id-tag">#BK-{{ booking.id }}</span></td>
                        <td>
                            <div class="user-cell">
                                <div class="user-avatar">{{ booking.userFullName?.charAt(0) }}</div>
                                <span>{{ booking.userFullName }}</span>
                            </div>
                        </td>
                        <td>
                            <div class="car-cell">
                                <img [src]="booking.carImageUrl | carImage" alt="Car">
                                <span>{{ booking.carName }}</span>
                            </div>
                        </td>
                        <td>
                            <div class="period-cell">
                                <span>{{ booking.startDate | date:'shortDate' }}</span>
                                <i class="fas fa-arrow-right"></i>
                                <span>{{ booking.endDate | date:'shortDate' }}</span>
                            </div>
                        </td>
                        <td><span class="price-value">\${{ booking.totalPrice }}</span></td>
                        <td>
                            <span class="status-badge" [ngClass]="getStatusClass(booking.status)">
                                {{ booking.status }}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button *ngIf="booking.status === BookingStatus.PENDING" class="btn-icon approve"
                                    (click)="updateStatus(booking.id!, BookingStatus.CONFIRMED)" title="Approve">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button *ngIf="booking.status === BookingStatus.PENDING" class="btn-icon reject"
                                    (click)="updateStatus(booking.id!, BookingStatus.REJECTED)" title="Reject">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button *ngIf="booking.status === BookingStatus.CONFIRMED" class="btn-icon complete"
                                    (click)="updateStatus(booking.id!, BookingStatus.COMPLETED)" title="Complete">
                                    <i class="fas fa-flag-checkered"></i>
                                </button>
                                <button class="btn-icon cancel" title="Cancel Booking"
                                    (click)="updateStatus(booking.id!, BookingStatus.CANCELLED)">
                                    <i class="fas fa-ban"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr *ngIf="filteredBookings.length === 0">
                        <td colspan="7" class="empty-row text-center">No bookings found matching your criteria.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<app-loading-spinner *ngIf="isLoading" message="Loading booking data..."></app-loading-spinner>